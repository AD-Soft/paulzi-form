/**
 * PaulZi-Form module
 * Provide: ajax submit, delete empty fields before submit, submit button style, form alert.
 * @module paulzi/paulzi-form
 * @external jQuery
 * @version 2.4.0
 * @author PaulZi (pavel.zimakoff@gmail.com)
 * @license MIT (https://github.com/paulzi/paulzi-form/blob/master/LICENSE)
 * @see https://github.com/paulzi/paulzi-form
 */
!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(this,function(t){var e=function(e){var a=e.find("output, .form-output").first();return e.hasData("formOutput")&&(a=t(e.data("formOutput"))),a},a=function(e){return-1!==t.inArray(e.prop("tagName"),["INPUT","BUTTON"])&&-1!==t.inArray(e.attr("type").toLowerCase(),["submit","image"])};t.fn.formAlert=function(a,r){var n=t(this),o=t(a);return o.hasClass("alert")||(r=r||"info",o=t('<div role="alert" class="alert alert-'+r+'">').append(o)),t.fn.alert&&!o.hasClass("alert-dismissible")&&(o.addClass("alert-dismissible"),t('<button type="button" class="close" aria-label="close" data-dismiss="alert">').html('<span aria-hidden="true">&times;</span>').prependTo(o)),o.addClass("fade in").appendTo(e(n)),o};var r=function(e){if(e.isDefaultPrevented())return!1;var r=t(this);if(r.hasClass("form-loading"))return e.preventDefault(),!1;r.addClass("form-loading");var n=t(document.activeElement).filter(".btn-loading");a(n)||(n=r.find(".btn-loading.btn-submit-default")),n.addClass("disabled");var o=n.data("loadingText");o&&(n.data("loadingText",n.text()),n.text(o));var i=n.data("loadingIcon");i&&(t("<span>&nbsp;</span>").addClass("btn-loading-space").prependTo(n),t("<i>").addClass("btn-loading-icon").addClass(i).prependTo(n))},n=function(){var e=t(this).find(".btn-loading.disabled");e.removeClass("disabled"),e.children(".btn-loading-icon, .btn-loading-space").remove(),e.each(function(){var e=t(this),a=e.data("loadingText");a&&e.data("loadingText",t(this).text()).text(a)})};t(document).on("submit.paulzi-form","form",r),t(document).on("formajaxalways.paulzi-form",".form-ajax",n);var o,i=["action","enctype","method","target"],l=function(){if("undefined"!=typeof o)return o;var t=document.createElement("input"),e=document.createElement("form"),a="paulzi-form-support";return e.id=a,document.body.appendChild(e),document.body.appendChild(t),t.setAttribute("form",a),o=t.form===e,document.body.removeChild(e),document.body.removeChild(t),o},s=function(){var t=document.createElement("input");return!!("formAction"in t)},u=function(){var e=this,r=t(this);if(!l()){var n=r.attr("id");if(n){t('[form="'+n+'"]').not("form#"+n+' [form="'+n+'"]').filter(function(){return this.name&&!t(this).is(":disabled")&&(this.checked||"checkbox"!==this.type&&"radio"!==this.type)}).each(function(){t('<input type="hidden">').attr("name",this.name).val(t(this).val()).addClass("paulzi-form-polyfill").appendTo(e)})}}if(!s()){var o=t(document.activeElement);a(o)&&t.each(i,function(t,e){var a=o.attr("form"+e);a&&r.data("paulziFormPolyfill"+e,a).attr(e,a)})}},f=function(){var e=t(this);l()||e.find(".paulzi-form-polyfill").remove(),s()||t.each(i,function(t,a){e.hasData("paulziFormPolyfill"+a)&&e.attr(a,e.data("paulziFormPolyfill"+a)).removeData("paulziFormPolyfill"+a)})};t(document).on("submit.paulzi-form","form",u),t(document).on("formajaxalways.paulzi-form","form",f);var d="paulzi-form-no-empty-item",m=function(){return t(this).find(":enabled").filter(function(){return""==this.value}).addClass(d).each(function(){this.disabled=!0}),!0},p=function(){t(this).find("."+d).removeClass(d).each(function(){this.disabled=!1})};t(document).on("submit.paulzi-form",".form-no-empty",m),t(document).on("formajaxalways.paulzi-form",".form-no-empty",p);var c=function(e){var a=t(this).offset();t(this).prop("paulziFormX",e.pageX-a.left).prop("paulziFormY",e.pageY-a.top)},v=function(r){if(r.isDefaultPrevented())return!1;if(t(document.activeElement).hasClass("btn-no-ajax"))return!0;r.preventDefault();var n=t(this),o=function(){var t=jqXHR.getResponseHeader("X-Redirect");return t?(document.location.href=t,!0):!1},i=function(a,r,i){var l=jQuery.Event("formajaxdone");if(n.trigger(l,arguments),!l.isDefaultPrevented()&&!o()&&/^text\/html(;|$)/.test(i.getResponseHeader("Content-Type"))){var s=t(t.parseHTML(a,!0));if(n.trigger("contentprepare",[s]),s.hasClass("form-replace"))n.replaceWith(s);else{var u=e(n),f=s.data("formOutput");f&&(u=t(f)),s.hasClass("alert")&&(s=n.formAlert(s)),u.html(s)}n.trigger("contentinit",[s])}},l=function(e,a,r){var i=jQuery.Event("formajaxfail");if(n.trigger(i,arguments),!i.isDefaultPrevented()&&!o()){var l=!1;e.responseText&&(l=t(t.parseHTML(e.responseText,!0))),l&&l.hasClass("alert")?n.formAlert(l):n.formAlert(["["+a+"]",r,e.responseText].join(" "),"danger")}},s=function(){var t=jQuery.Event("formajaxalways");n.trigger(t,arguments),t.isDefaultPrevented()||n.removeClass("form-loading")},u=function(t,e){var a=jQuery.Event("formajaxbefore");return n.trigger(a,[t,e]),!a.isDefaultPrevented()};if("multipart/form-data"==n.attr("enctype")&&"function"==typeof t.fn.ajaxSubmit)n.ajaxSubmit({beforeSubmit:function(t,e,a){a.beforeSend=u},success:i,error:l,complete:s,data:{"X-Requested-With":"XMLHttpRequest"},uploadProgress:function(t){var e=0,a=t.loaded||t.position,r=t.total;t.lengthComputable&&(e=a/r*100),n.trigger("formajaxprogress",[a,r,e])}});else{var f=n.attr("action"),d=n.attr("method")||"GET",m=n.serializeArray(),p=t(document.activeElement);p.attr("name")&&!p.is(":disabled")&&a(p)&&(p.attr("formaction")&&(f=p.attr("formaction")),p.attr("formmethod")&&(d=p.attr("formmethod")),m.push({name:p.attr("name"),value:p.val()}),p.prop("paulziformX")&&(m.push({name:p.attr("name")+".x",value:p.prop("paulziformX")}),p.removeProp("paulziformX")),p.prop("paulziformY")&&(m.push({name:p.attr("name")+".y",value:p.prop("paulziformY")}),p.removeProp("paulziformY"))),t.ajax({method:d,url:f,data:m,beforeSend:u}).done(i).fail(l).always(s)}return!1};t(document).on("click.paulzi-form",'input[type="image"]',c),t(document).on("submit.paulzi-form",".form-ajax",v)});