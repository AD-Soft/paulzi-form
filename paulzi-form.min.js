/**
 * PaulZi-Form module
 * Provide: ajax submit, delete empty fields before submit, submit button style, form alert.
 * @module paulzi/form
 * @version 2.3.0
 * @author PaulZi (pavel.zimakoff@gmail.com)
 * @license MIT (https://github.com/Paul-Zi/paulzi-form/blob/master/LICENSE)
 * @see https://github.com/Paul-Zi/paulzi-form
 */
!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(this,function(t){t.fn.formAlert=function(e,a){var r,n=t(this).find("output, .form-output").first();return"string"!=typeof e&&t(e).hasClass("alert")?r=e:(a=a||"info",r=t('<div role="alert" class="alert alert-'+a+'">').append(e)),t.fn.alert&&(r.addClass(["alert-dismissible"]),t('<button type="button" class="close" aria-label="close" data-dismiss="alert">').html('<span aria-hidden="true">&times;</span>').prependTo(r)),r.addClass("fade in").appendTo(n),r};var e=function(e){return-1!==t.inArray(e.prop("tagName"),["INPUT","BUTTON"])&&-1!==t.inArray(e.attr("type").toLowerCase(),["submit","image"])},a=function(a){if(a.isDefaultPrevented())return!1;if(t(this).hasClass("form-loading"))return a.preventDefault(),!1;t(this).addClass("form-loading");var r=t(document.activeElement).filter(".btn-loading");e(r)||(r=t(this).find(".btn-loading.btn-submit-default")),r.addClass("disabled");var n=r.data("loadingText");n&&(r.data("loadingText",r.text()),r.text(n));var o=r.data("loadingIcon");o&&(t("<span>&nbsp;</span>").addClass("btn-loading-space").prependTo(r),t("<i>").addClass("btn-loading-icon").addClass(o).prependTo(r))},r=function(){var e=t(this).find(".btn-loading.disabled");e.removeClass("disabled"),e.children(".btn-loading-icon, .btn-loading-space").remove(),e.each(function(){var e=t(this).data("loadingText");e&&(t(this).data("loadingText",t(this).text()),t(this).text(e))})};t(document).on("submit.paulzi-form","form",a),t(document).on("formajaxalways.paulzi-form",".form-ajax",r);var n,o=["action","enctype","method","target"],i=function(){if("undefined"!=typeof n)return n;var t=document.createElement("input"),e=document.createElement("form"),a="__test-input-form-reference-support";return e.id=a,document.body.appendChild(e),document.body.appendChild(t),t.setAttribute("form",a),n=t.form===e,document.body.removeChild(e),document.body.removeChild(t),n},s=function(){var t=document.createElement("input");return!!("formAction"in t)},l=function(){var a=this,r=t(this);if(!i()){var n=r.attr("id");if(n){t('[form="'+n+'"]').not("form#"+n+' [form="'+n+'"]').filter(function(){return this.name&&!t(this).is(":disabled")&&(this.checked||"checkbox"!==this.type&&"radio"!==this.type)}).each(function(){t('<input type="hidden">').attr("name",this.name).val(t(this).val()).addClass("form-html5-attributes-polyfill").appendTo(a)})}}if(!s()){var l=t(document.activeElement);e(l)&&t.each(o,function(t,e){var a=l.attr("form"+e);a&&(r.data("formAttrPolyfill"+e,a),r.attr(e,a))})}},f=function(){var e=t(this);i()||e.find(".form-html5-attributes-polyfill").remove(),s()||t.each(o,function(t,a){e.hasData("formAttrPolyfill"+a)&&(e.attr(a,e.data("formAttrPolyfill"+a)),e.removeData("formAttrPolyfill"+a))})};t(document).on("submit.paulzi-form","form",l),t(document).on("formajaxalways.paulzi-form","form",f);var m=function(){return t(this).find(":enabled").filter(function(){return""==this.value}).addClass("form-no-empty-item").each(function(){this.disabled=!0}),!0},u=function(){t(this).find(".form-no-empty-item").removeClass("form-no-empty-item").each(function(){this.disabled=!1})};t(document).on("submit.paulzi-form",".form-no-empty",m),t(document).on("formajaxalways.paulzi-form",".form-no-empty",u);var d=function(e){var a=t(this).offset();t(this).prop("paulziFormX",e.pageX-a.left),t(this).prop("paulziFormY",e.pageY-a.top)},p=function(a){if(a.isDefaultPrevented())return!1;if(t(document.activeElement).hasClass("btn-no-ajax"))return!0;a.preventDefault();var r=t(this),n=r.find("output, .form-output").empty();r.data("form-output")&&(n=t(r.data("form-output")));var o=function(e){var a=jQuery.Event("formajaxdone");if(r.trigger(a,arguments),!a.isDefaultPrevented()&&"string"==typeof e){e=t(t.parseHTML(e,!0));var o=e.data("redirect");if(o)return void(document.location.href=o);r.trigger("contentprepare",[e]),e.hasClass("form-replace")?r.replaceWith(e):e.hasClass("alert")?r.formAlert(e):n.html(e),r.trigger("contentinit",[e])}},i=function(e,a,n){var o=jQuery.Event("formajaxfail");if(r.trigger(o,arguments),!o.isDefaultPrevented()){var i=!1;e.responseText&&(i=t(t.parseHTML(e.responseText,!0))),i&&i.hasClass("alert")?r.formAlert(i):r.formAlert(["["+a+"]",n,e.responseText].join(" "),"danger")}},s=function(){var t=jQuery.Event("formajaxalways");r.trigger(t,arguments),t.isDefaultPrevented()||r.removeClass("form-loading")},l=function(t,e){var a=jQuery.Event("formajaxbefore");return r.trigger(a,[t,e]),!a.isDefaultPrevented()};if("multipart/form-data"==r.attr("enctype")&&"function"==typeof t.fn.ajaxSubmit)r.ajaxSubmit({beforeSubmit:function(t,e,a){a.beforeSend=l},success:o,error:i,complete:s,data:{"X-Requested-With":"XMLHttpRequest"},uploadProgress:function(t){var e=0,a=t.loaded||t.position,n=t.total;t.lengthComputable&&(e=a/n*100),r.trigger("formajaxprogress",[a,n,e])}});else{var f=r.serializeArray(),m=t(document.activeElement);m.attr("name")&&!m.is(":disabled")&&e(m)&&(f.push({name:m.attr("name"),value:m.val()}),m.prop("paulziFormX")&&(f.push({name:m.attr("name")+".x",value:m.prop("paulziFormX")}),m.removeProp("paulziFormX")),m.prop("paulziFormY")&&(f.push({name:m.attr("name")+".y",value:m.prop("paulziFormY")}),m.removeProp("paulziFormY"))),t.ajax({method:r.attr("method")||"GET",url:r.attr("action"),data:f,beforeSend:l}).done(o).fail(i).always(s)}return!1};t(document).on("click.paulzi-form",'input[type="image"]',d),t(document).on("submit.paulzi-form",".form-ajax",p)});