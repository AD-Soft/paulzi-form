/**
 * PaulZi-Form module
 * Provide: ajax submit, delete empty fields before submit, submit button style, form alert.
 * @module paulzi/form
 * @version 2.3.1
 * @author PaulZi (pavel.zimakoff@gmail.com)
 * @license MIT (https://github.com/Paul-Zi/paulzi-form/blob/master/LICENSE)
 * @see https://github.com/Paul-Zi/paulzi-form
 */
!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(this,function(t){t.fn.formAlert=function(e,a){var r,o=t(this).find("output, .form-output").first();return"string"!=typeof e&&t(e).hasClass("alert")?r=e:(a=a||"info",r=t('<div role="alert" class="alert alert-'+a+'">').append(e)),t.fn.alert&&(r.addClass(["alert-dismissible"]),t('<button type="button" class="close" aria-label="close" data-dismiss="alert">').html('<span aria-hidden="true">&times;</span>').prependTo(r)),r.addClass("fade in").appendTo(o),r};var e=function(e){return-1!==t.inArray(e.prop("tagName"),["INPUT","BUTTON"])&&-1!==t.inArray(e.attr("type").toLowerCase(),["submit","image"])},a=function(a){if(a.isDefaultPrevented())return!1;if(t(this).hasClass("form-loading"))return a.preventDefault(),!1;t(this).addClass("form-loading");var r=t(document.activeElement).filter(".btn-loading");e(r)||(r=t(this).find(".btn-loading.btn-submit-default")),r.addClass("disabled");var o=r.data("loadingText");o&&(r.data("loadingText",r.text()),r.text(o));var n=r.data("loadingIcon");n&&(t("<span>&nbsp;</span>").addClass("btn-loading-space").prependTo(r),t("<i>").addClass("btn-loading-icon").addClass(n).prependTo(r))},r=function(){var e=t(this).find(".btn-loading.disabled");e.removeClass("disabled"),e.children(".btn-loading-icon, .btn-loading-space").remove(),e.each(function(){var e=t(this).data("loadingText");e&&(t(this).data("loadingText",t(this).text()),t(this).text(e))})};t(document).on("submit.paulzi-form","form",a),t(document).on("formajaxalways.paulzi-form",".form-ajax",r);var o,n=["action","enctype","method","target"],i=function(){if("undefined"!=typeof o)return o;var t=document.createElement("input"),e=document.createElement("form"),a="__test-input-form-reference-support";return e.id=a,document.body.appendChild(e),document.body.appendChild(t),t.setAttribute("form",a),o=t.form===e,document.body.removeChild(e),document.body.removeChild(t),o},l=function(){var t=document.createElement("input");return!!("formAction"in t)},s=function(){var a=this,r=t(this);if(!i()){var o=r.attr("id");if(o){t('[form="'+o+'"]').not("form#"+o+' [form="'+o+'"]').filter(function(){return this.name&&!t(this).is(":disabled")&&(this.checked||"checkbox"!==this.type&&"radio"!==this.type)}).each(function(){t('<input type="hidden">').attr("name",this.name).val(t(this).val()).addClass("paulzi-form-polyfill").appendTo(a)})}}if(!l()){var s=t(document.activeElement);e(s)&&t.each(n,function(t,e){var a=s.attr("form"+e);a&&(r.data("paulziFormPolyfill"+e,a),r.attr(e,a))})}},d=function(){var e=t(this);i()||e.find(".paulzi-form-polyfill").remove(),l()||t.each(n,function(t,a){e.hasData("paulziFormPolyfill"+a)&&(e.attr(a,e.data("paulziFormPolyfill"+a)),e.removeData("paulziFormPolyfill"+a))})};t(document).on("submit.paulzi-form","form",s),t(document).on("formajaxalways.paulzi-form","form",d);var m=function(){return t(this).find(":enabled").filter(function(){return""==this.value}).addClass("form-no-empty-item").each(function(){this.disabled=!0}),!0},u=function(){t(this).find(".form-no-empty-item").removeClass("form-no-empty-item").each(function(){this.disabled=!1})};t(document).on("submit.paulzi-form",".form-no-empty",m),t(document).on("formajaxalways.paulzi-form",".form-no-empty",u);var f=function(e){var a=t(this).offset();t(this).prop("paulziFormX",e.pageX-a.left),t(this).prop("paulziFormY",e.pageY-a.top)},p=function(a){if(a.isDefaultPrevented())return!1;if(t(document.activeElement).hasClass("btn-no-ajax"))return!0;a.preventDefault();var r=t(this),o=r.find("output, .form-output").empty();r.data("form-output")&&(o=t(r.data("form-output")));var n=function(e,a,n){var i=jQuery.Event("formajaxdone");if(r.trigger(i,arguments),!i.isDefaultPrevented()){var l=n.getResponseHeader("X-Redirect");return l?void(document.location.href=l):void(/^text\/html(;|$)/.test(n.getResponseHeader("Content-Type"))&&(e=t(t.parseHTML(e,!0)),r.trigger("contentprepare",[e]),e.hasClass("form-replace")?r.replaceWith(e):e.hasClass("alert")?r.formAlert(e):o.html(e),r.trigger("contentinit",[e])))}},i=function(e,a,o){var n=jQuery.Event("formajaxfail");if(r.trigger(n,arguments),!n.isDefaultPrevented()){var i=e.getResponseHeader("X-Redirect");if(i)return void(document.location.href=i);var l=!1;e.responseText&&(l=t(t.parseHTML(e.responseText,!0))),l&&l.hasClass("alert")?r.formAlert(l):r.formAlert(["["+a+"]",o,e.responseText].join(" "),"danger")}},l=function(){var t=jQuery.Event("formajaxalways");r.trigger(t,arguments),t.isDefaultPrevented()||r.removeClass("form-loading")},s=function(t,e){var a=jQuery.Event("formajaxbefore");return r.trigger(a,[t,e]),!a.isDefaultPrevented()};if("multipart/form-data"==r.attr("enctype")&&"function"==typeof t.fn.ajaxSubmit)r.ajaxSubmit({beforeSubmit:function(t,e,a){a.beforeSend=s},success:n,error:i,complete:l,data:{"X-Requested-With":"XMLHttpRequest"},uploadProgress:function(t){var e=0,a=t.loaded||t.position,o=t.total;t.lengthComputable&&(e=a/o*100),r.trigger("formajaxprogress",[a,o,e])}});else{var d=r.attr("action"),m=r.attr("method")||"GET",u=r.serializeArray(),f=t(document.activeElement);f.attr("name")&&!f.is(":disabled")&&e(f)&&(f.attr("formaction")&&(d=f.attr("formaction")),f.attr("formmethod")&&(m=f.attr("formmethod")),u.push({name:f.attr("name"),value:f.val()}),f.prop("paulziFormX")&&(u.push({name:f.attr("name")+".x",value:f.prop("paulziFormX")}),f.removeProp("paulziFormX")),f.prop("paulziFormY")&&(u.push({name:f.attr("name")+".y",value:f.prop("paulziFormY")}),f.removeProp("paulziFormY"))),t.ajax({method:m,url:d,data:u,beforeSend:s}).done(n).fail(i).always(l)}return!1};t(document).on("click.paulzi-form",'input[type="image"]',f),t(document).on("submit.paulzi-form",".form-ajax",p)});