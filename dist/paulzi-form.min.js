/**
 * PaulZi Form
 * @see https://github.com/paulzi/paulzi-form
 * @license MIT (https://github.com/paulzi/paulzi-form/blob/master/LICENSE)
 * @version 3.0.0
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(c){return a.PaulZiForm=b(c)}):"object"==typeof exports?module.exports=b(require("jquery")):a.PaulZiForm=b(a.jQuery)}(this,function(a){"use strict";var b=function(b){var c=a();return b.icon&&(c=c.add(a("<i>").addClass(b.icon))),b.text&&(c=c.add(a("<span>").text(b.text))),c},c=a.extend(!0,{classes:{formLoading:"form-loading",btnLoading:"btn-loading"},attributes:{via:"data-via",lock:"data-lock",submitEmpty:"data-submit-empty",to:"data-insert-to",context:"data-insert-context",mode:"data-insert-mode",loadingText:"data-loading-text",loadingIcon:"data-loading-icon"},defaults:{lock:!0,submitEmpty:!0,to:"output",context:"this",mode:"html",skipOnError:!1},defaultTemplate:b,buttonLoadingTemplate:b,buttonLoadingForce:!1},window.PaulZiForm||{}),d="paulziForm",e="."+d,f=c.classes,g=c.attributes,h=c.defaults,i=function(b){var c='input[type="submit"],input[type="image"],button[type="submit"]',d=a(document.activeElement).filter(c);return a.each(b.elements,function(b,e){e=a(e).filter(c),!d.length&&e.length&&(d=e)}),d},j=d+"NoEmpty",k=function(b){var c=a(b.target),d=[];a.each(c.prop("elements"),function(b,e){if(""===e.value&&!e.disabled&&"submit"!==e.type){var f=a(e).closest("["+g.submitEmpty+"]").attr(g.submitEmpty)||c.attr(g.submitEmpty);f=f?-1!==a.inArray(f,["1","true"]):h.submitEmpty,f||(e.disabled=!0,d.push(e))}}),c.data(j,d)},l=function(b){var c=a(b.target).data(j);c&&a.each(c,function(a,b){b.disabled=!1})};a(document).on("submitbefore"+e,k),a(document).on("submitstart"+e,l);var m=d+"Lock",n=function(b){var c=a(b.target);if(c.data(m)){var d=c.attr(g.lock);("undefined"!=typeof d?-1!==a.inArray(d,["1","true"]):h.lock)&&b.preventDefault()}},o=function(b){a(b.target).data(m,!0)},p=function(b){a(b.target).data(m,!1)};a(document).on("submitlast"+e,n),a(document).on("submitbefore"+e,o),a(document).on("submitend"+e,p);var q=d+"Scenario",r=function(b){var c=a(b.target),d=[];a.each(c.prop("elements"),function(c,e){var f=a(e).closest("["+g.via+"]").attr(g.via);f&&"all"!==f&&f!==b.transport&&!e.disabled&&"submit"!==e.type&&(e.disabled=!0,d.push(e))}),c.data(q,d)},s=function(b){var c=a(b.target).data(q);c&&a.each(c,function(a,b){b.disabled=!1})};a(document).on("submitbefore"+e,r),a(document).on("submitstart"+e,s);var t=function(b){var c=a(this),e=c.offset();c.data(d+"X",Math.round(b.pageX-e.left)).data(d+"Y",Math.round(b.pageY-e.top))},u=function(b){var c=a(b.target),e=i(b.target),f=c.attr(g.via),h=e.attr(g.via);if(!b.isDefaultPrevented()&&("ajax"===f&&!h||"ajax"===h)){b.preventDefault();var j=a.Event("submitajax");if(c.trigger(j),!j.isDefaultPrevented()){c.trigger({type:"submitbefore",transport:"ajax"});var k={url:e.attr("formaction")||c.attr("action"),method:e.attr("formmethod")||c.attr("method")||"GET",contentType:e.attr("formenctype")||c.attr("enctype"),xhr:function(){var b=a.ajaxSettings.xhr(),d=function(b){return function(d){var e=a.Event(d,{type:b,loaded:d.loaded,total:d.total,lengthComputable:d.lengthComputable});c.trigger(e)}};return b.addEventListener&&b.addEventListener("progress",d("downloadprogress")),b.upload&&b.upload.addEventListener&&(b.upload.addEventListener("progress",d("uploadprogress")),b.upload.addEventListener("loadend",d("uploadend"))),b}},l=[],m=e.attr("name");if(m){var n;n=e.data(d+"X"),"undefined"!=typeof n?l.push({name:m+".x",value:n}):l.push({name:m,value:e.val()}),n=e.data(d+"Y"),"undefined"!=typeof n&&l.push({name:m+".y",value:n})}var o=function(){c.trigger({type:"submitstart",transport:"ajax"})};if("multipart/form-data"===k.contentType)if("FormData"in window){var p=new FormData(c[0]);a.each(l,function(a,b){p.append(b.name,b.value)}),k.data=p,k.processData=!1,k.contentType=!1}else k.data=l,k.form=c[0],k.iframe=!0,k.iframeOnSubmit=o;else k.data=a.merge(c.serializeArray(),l);a.ajax(k).done(function(a,b,d){c.trigger({type:"submitdone",transport:"ajax"},[a,d])}).fail(function(a,b,d){c.trigger({type:"submitfail",transport:"ajax"},[a.responseText,a,d])}).always(function(){var a,b,d;"object"==typeof arguments[2]?(a=arguments[0],b=arguments[2]):(a=arguments[0].responseText,b=arguments[0],d=arguments[2]),c.trigger({type:"submitend",transport:"ajax"},[a,b,d])}),k.iframe||o()}}};a(document).on("click"+e,'input[type="image"]',t),a(document).on("submitlast"+e,u);var v=function(b,c,d,e){if("ajax"===b.transport){var f=d.getResponseHeader("X-Redirect");f&&(document.location.href=f,b.preventDefault());var i=d.getResponseHeader("Content-Type");if(!b.isDefaultPrevented()&&(null===i||/^text\/html(;|$)/.test(i))){var j=a(b.target),k=a(a.parseHTML(c,!0));e&&h.skipOnError||k.each(function(){var b=a(this),c=b.attr(g.to)||j.attr(g.to)||h.to,d=b.attr(g.context)||j.attr(g.context)||h.context,e=b.attr(g.mode)||j.attr(g.mode)||h.mode;d&&c&&(d="document"===d?a(document):"this"===d?j:j.closest(d),c="context"===c?d:d.find(c)),c&&c.length&&c[e]&&(j.trigger("contentprepare",[k,e,c]),c[e](this),j.trigger("contentinit",[k,e,c]))})}}};g.via!==!1&&a(document).on("submitend"+e,v);var w=function(b){var e=a(b.target).addClass(f.formLoading),h=i(b.target).addClass(f.btnLoading),j={form:e[0],btn:h[0],text:h.attr(g.loadingText),icon:h.attr(g.loadingIcon)};if(e.data(d+"Btn",h),j.text||j.icon||c.buttonLoadingForce){var k=c.buttonLoadingTemplate(j);k&&(h.data(d+"Old",h.contents()),h.html(k))}},x=function(b){var c=a(b.target).removeClass(f.formLoading),e=c.data(d+"Btn");if(e){var g=e.data(d+"Old");e.html(g),e.removeClass(f.btnLoading)}};return a(document).on("submitbefore"+e,w),a(document).on("submitend"+e,x),c});